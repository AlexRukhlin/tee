#resources:
#- repo: self
#
queue:
  name: Hosted VS2017

variables:
#  dockerRegistryConnectionEndpoint: '69a1a8df-4cb8-46ce-9e6e-e8197ff93ded'    # VSTS service connection endpoint "Docker Registry"
#  dockerHostEndpoint: '3f5ecfa0-cdda-4405-aad7-e3e5cc508d2a'                  # VSTS service connection endpoint "Docker Host"
  dockerRegistryConnectionEndpoint: ''    # VSTS service connection endpoint "Docker Registry"
  dockerHostEndpoint: ''                  # VSTS service connection endpoint "Docker Host"
  imageName: '$(Build.Repository.Name):$(Build.BuildId)'
  qualifyImageName: true
  enforceDockerNamingConvention: true
  defaultContext: true

steps:
- task: Docker@0
  inputs:
    containerregistrytype: 'Container Registry'
    dockerRegistryConnection: '$(dockerRegistryConnectionEndpoint)'
    action: 'Build an image'
    dockerFile: '**/Dockerfile'
#    buildArguments: |
#      HTTP_PROXY=http://1.192.168.254
#      BUILD_NUMBER=$(Build.BuildNumber)
    defaultContext: $defaultContext)
    imageName: '$(imageName)'
    qualifyImageName: $(qualifyImageName)
#    additionalImageTags: |
#      Tag1
#      Tag2
    includeSourceTags: false
    includeLatestTag: false
    dockerHostEndpoint: '$(dockerHostEndpoint)'
    enforceDockerNamingConvention: $(enforceDockerNamingConvention)

- task: Docker@0
  inputs:
    containerregistrytype: 'Container Registry'
    dockerRegistryConnection: '$(dockerRegistryConnectionEndpoint)'
    action: 'Push an image'
    imageName: '$(imageName)'
    qualifyImageName: $(qualifyImageName)
#    additionalImageTags: |
#      Tag3
#      Tag4
    includeSourceTags: false
    includeLatestTag: false
    dockerHostEndpoint: '$(dockerHostEndpoint)'
    enforceDockerNamingConvention: $(enforceDockerNamingConvention)
